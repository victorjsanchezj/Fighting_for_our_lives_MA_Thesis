<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Luchando contra futuras pandemias</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Fighting for our lives: Accompanying website</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="Cartography.html">Producing basic cartographies</a>
</li>
<li>
  <a href="Links.html">Quantitative Analysis</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Luchando contra futuras pandemias</h1>

</div>


<style type="text/css">
.title {
  display: none;
}

#getting-started img {
  margin-right: 10px;
}

</style>
<div class="row" style="padding-top: 30px;">
<div class="col-sm-6">

<div id="bienvenidoa" class="section level1">
<h1><strong>¡Bienvenido/a!</strong></h1>
<p>Esta página web es una forma de documentar el código en el que se base el analisis cuantitativo de mi proyecto de investigación. Está diseñada para ser usada al tiempo que se lee el artículo.</p>
<div id="cómo-puedes-utilizar-esta-web" class="section level2">
<h2>¿Cómo puedes utilizar esta web?</h2>
<ol style="list-style-type: decimal">
<li><p>La página está organizada en varias pestañas. PERO hemos tenido errores técnicos de última hora. He debido borrar algún archivo sin darme cuenta y las pestañas no sólo son inservibles sino que además los hipervinculos están rotos. En su lugar, está página esta organizada por secciones por las que puedes navegar según lo que te interese.</p></li>
<li><p>El objetivo de esta web es hacer mi investigación reproducible y transparente. Por lo tanto, podrás encontrar explicaciones de mi código (escrito en el lenguaje de programación R). Las explicaciones bien son introducidas antes del código o entre el código (en ese caso, las explicaciones están introducidas por una almohodilla “#”).</p></li>
</ol>
<p>#1 Creando un mapa de las granjas indsutriales de porcino existentes.</p>
<p>Empezamos cargando las librerías que utilizaremos.</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## Warning: package &#39;tidyverse&#39; was built under R version 4.0.5</code></pre>
<pre><code>## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --</code></pre>
<pre><code>## v ggplot2 3.3.5     v purrr   0.3.4
## v tibble  3.1.2     v dplyr   1.0.7
## v tidyr   1.1.3     v stringr 1.4.0
## v readr   2.0.0     v forcats 0.5.1</code></pre>
<pre><code>## Warning: package &#39;ggplot2&#39; was built under R version 4.0.5</code></pre>
<pre><code>## Warning: package &#39;tibble&#39; was built under R version 4.0.5</code></pre>
<pre><code>## Warning: package &#39;tidyr&#39; was built under R version 4.0.5</code></pre>
<pre><code>## Warning: package &#39;readr&#39; was built under R version 4.0.5</code></pre>
<pre><code>## Warning: package &#39;purrr&#39; was built under R version 4.0.2</code></pre>
<pre><code>## Warning: package &#39;dplyr&#39; was built under R version 4.0.5</code></pre>
<pre><code>## Warning: package &#39;stringr&#39; was built under R version 4.0.3</code></pre>
<pre><code>## Warning: package &#39;forcats&#39; was built under R version 4.0.5</code></pre>
<pre><code>## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(sf)</code></pre>
<pre><code>## Warning: package &#39;sf&#39; was built under R version 4.0.5</code></pre>
<pre><code>## Linking to GEOS 3.9.0, GDAL 3.2.1, PROJ 7.2.1</code></pre>
<pre class="r"><code>library(ggspatial)</code></pre>
<pre><code>## Warning: package &#39;ggspatial&#39; was built under R version 4.0.5</code></pre>
<pre class="r"><code>library(readxl)</code></pre>
<pre><code>## Warning: package &#39;readxl&#39; was built under R version 4.0.2</code></pre>
<pre class="r"><code>library(writexl)</code></pre>
<pre><code>## Warning: package &#39;writexl&#39; was built under R version 4.0.5</code></pre>
<pre class="r"><code>library(sf)
library(tidygeocoder)</code></pre>
<pre><code>## Warning: package &#39;tidygeocoder&#39; was built under R version 4.0.5</code></pre>
<p>El primer mapa que crearemos será un mapa de las macrogranjas existentes en CLM en 2019.</p>
<p>Primeramente, importamos un excel que contiene las granjas porcinas con al menos 2000 cabezas. Es un excel creado a partir del Censo Porcino de CLM. Lo creé en base a datos de la Junta.</p>
<pre class="r"><code>villages_macrogranjas &lt;- read_excel(&quot;data/porcino +2000.xlsx&quot;)</code></pre>
<p>Para nuestro siguiente paso tenemos que “limpiar” nuestros datos. Como varios pueblos contienen artículos en sus nombres (ex: El Bonillo), vamos a usar la siguiente línea de código para separar el nombre de los pueblos con artículos en dos. Tendremos una columna que contendrá el artículot otra el municipio sin artículo.</p>
<pre class="r"><code>villages_macrogranjas_municipality_split &lt;- villages_macrogranjas %&gt;% 
  separate(Municipio,c(&quot;MUNICIPIO&quot;,&quot;ARTICULO&quot;),sep=&quot;,&quot;)</code></pre>
<pre><code>## Warning: Expected 2 pieces. Missing pieces filled with `NA` in 333 rows [1, 2,
## 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 15, 16, 17, 18, 19, 20, 21, 22, ...].</code></pre>
<p>Como el lector/la lectora habrá podido observar, el excel con el que estamos trabajando no cuenta con coordenadas. Esto es un problema a la hora de crear un mapa. Afortunadamente, podemos usar el siguiente código para geocodificar automáticamente los pueblos donde existe(n), al menos, una granja con 2000 o más cabezas de porcino. Para realizar la geodificación, estamos solicitando acceso a los datos de Open Street Maps.</p>
<pre class="r"><code>villages_geocoded &lt;- villages_macrogranjas_municipality_split %&gt;%
  geocode(&quot;MUNICIPIO&quot;, method = &#39;osm&#39;, lat = latitude , long = longitude, min_time=2)</code></pre>
<pre class="r"><code>CLM_provinces &lt;- st_read(&quot;data/Provincias.shp&quot;) </code></pre>
<pre><code>## Reading layer `Provincias&#39; from data source 
##   `C:\Victor\UCLM\Master\Clases\Seminario metodologia\Audiovisual\Web\Luchando_contra_futuras_pandemias\data\Provincias.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 5 features and 7 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -5.405995 ymin: 38.02244 xmax: -0.9159556 ymax: 41.32763
## Geodetic CRS:  WGS 84</code></pre>
<p>Now we just have to plot our data in a new map!</p>
<pre class="r"><code>CLM_provinces %&gt;%
  ggplot(aes(&quot;gray33&quot;))+
  geom_sf(color = &quot;black&quot;, size = 0.1) +
  geom_point(data=villages_geocoded, aes(x=longitude, y=latitude, size=Animales, colour=&quot;pink&quot;, alpha=0.01)) +
  annotation_scale(location = &quot;br&quot;, width_hint = 0.5) +
  annotation_north_arrow(location = &quot;br&quot;, which_north = &quot;true&quot;, 
                         pad_x = unit(0.75, &quot;in&quot;), pad_y = unit(0.5, &quot;in&quot;),
                         style = north_arrow_fancy_orienteering) +
  coord_sf(xlim = c(-5.5, -0.5), ylim = c(38, 41.30)) +
  guides(colour = FALSE, alpha = FALSE)+
  xlab(&quot;Longitud&quot;)+
  ylab(&quot;Latitud&quot;)</code></pre>
<pre><code>## Warning: `guides(&lt;scale&gt; = FALSE)` is deprecated. Please use `guides(&lt;scale&gt; =
## &quot;none&quot;)` instead.</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>¡Aquí tenemos nuestro primer mapa!</p>
<p>#2 Creando un mapa de las granjas indsutriales de porcino proyectadas.</p>
<p>Finalmente, vamos a crear un mapa de las granjas industriales de porcino proyectadas en CLM. Los datos provienen del NEVIA, un repositorio de la Junta de CLM que recoge los proyectos de evaluación ambiental. Es una fuente muy útil pero algo incompleta. No siempre determina la cantidad de cabezas que una granja planea tener en las mismas unidades (en ocasiones se usan cabezas y, en otras ocasiones, se usan Unidades Ganaderas Mayores). Por lo tanto, sólo podemos dar información sobre los lugares en los que se han proyectados granjas con 2000 o más cabezas (o bien con su equivalencia en Unidades Ganaderas Mayores).</p>
<pre class="r"><code>projected_macrogranjas &lt;- read_excel(&quot;data/projected_macrogranjas_clean.xlsx&quot;)</code></pre>
<p>Al igual que en último mapa, nuestra base de datos inicial no tienen geocoordenadas. No tenemos que preocuparnos, Open Street Maps nos volverá a sacar de esta situación.</p>
<pre class="r"><code>projected_macrogranjas_geocoded &lt;- projected_macrogranjas %&gt;%
  geocode(&quot;Municipio&quot;, method = &#39;osm&#39;, lat = latitude , long = longitude, min_time=2)</code></pre>
<p>Finalmente, sólo tenemos que crear nuestro segundo mapa.</p>
<pre class="r"><code>CLM_provinces %&gt;%
  ggplot(aes(&quot;gray33&quot;))+
  geom_sf(color = &quot;black&quot;, size = 0.1) +
  geom_point(data=projected_macrogranjas_geocoded, colour=&quot;purple3&quot;, aes(x=longitude, y=latitude, alpha=0.01)) +
  annotation_scale(location = &quot;br&quot;, width_hint = 0.5) +
  annotation_north_arrow(location = &quot;br&quot;, which_north = &quot;true&quot;, 
                         pad_x = unit(0.75, &quot;in&quot;), pad_y = unit(0.5, &quot;in&quot;),
                         style = north_arrow_fancy_orienteering) +
  coord_sf(xlim = c(-5.5, -0.5), ylim = c(38, 41.30)) +
  guides(colour = FALSE, alpha = FALSE)+
  xlab(&quot;Longitud&quot;)+
  ylab(&quot;Latitud&quot;)</code></pre>
<pre><code>## Warning: `guides(&lt;scale&gt; = FALSE)` is deprecated. Please use `guides(&lt;scale&gt; =
## &quot;none&quot;)` instead.</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>#3 Exportaciones de carne de porcino españolas.</p>
<p>En esta sección vamos a crear un gráfico de barras de las exportaciones de carne porcina españolas. Conseguí los datos del Ministerio de Agricultura y Pesca de España, del último informe publicado del sector porcino. Manualmente, creé un Excel con las exportaciones anuales a China y a otros países de la UE. ¡Empecemos leyendo el excel! ;)</p>
<pre class="r"><code>exports&lt;- read_excel(&quot;data/pigmeat_exports2.xlsx&quot;)</code></pre>
<p>Como estamos usando números relativamente grandes, la tendencia de R es usar la notación cientifica. No es lo que queremos en este proyecto porque dificultaría la lectura de nuestro gráfico. Por lo tanto, vamos a solucionarlo con el siguiente código que establece la notación cientifica automática para cantidades superiores a las 2.000.000.000 unidades.</p>
<pre class="r"><code>options(scipen=2000000000)</code></pre>
<p>Finalmente, solo tenemos que pedir a R que dibuje nuestro gráfico.</p>
<pre class="r"><code>ggplot(data = exports, mapping = aes(x=Año, y=Toneladas, fill=Destino)) +
  scale_fill_manual(values = c(&quot;bisque4&quot;, &quot;black&quot;))+
  geom_bar(stat=&quot;identity&quot;, position = &quot;dodge&quot;)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>¡Y aquí tenemos nuestro gráfico de barras!</p>
<p>#4 Importaciones de soja a España.</p>
<p>Finalmente, nos queda la tarea más fácil: Mostrar los datos que hemos utilizado para determinar que España importa la mayoría del grano con el que se alimentan a cerdos estabulados del Sur Global. Para ello, descargué los datos de importaciones españolas de los productos de la soja realizadas en 2019 de FAOSTAT. El siguiente código carga el archivo CSV, el cual preparé de antemano calculando el porcentaje total de cada país.</p>
<pre class="r"><code>imports&lt;- read_csv(&quot;data/Imports_feed_Spain_2019.csv&quot;)</code></pre>
<pre><code>## Rows: 80 Columns: 1</code></pre>
<pre><code>## -- Column specification --------------------------------------------------------
## Delimiter: &quot;,&quot;
## chr (1): Código de dóminio;Dóminio;Código del país que reporta los datos (FA...</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>#5 Bibliografía extendida.</p>
<p>Barton, M. D. (2014) Impact of antibiotic use in the swine industry. Current opinion in microbiology. 199–15.</p>
<p>Blaikie, P. M. &amp; Brookfield, H. C. (1987) Land degradation and society. London ; New York: Methuen. Faostat (2021) FAOSTAT|Trade|Detailed Trade Matrix [online]. Available from: <a href="http://www.fao.org/faostat/en/#data" class="uri">http://www.fao.org/faostat/en/#data</a> (Accessed 19 August 2021).</p>
<p>Foster, J. B. et al. (2000) ‘An Overview.’, in John Bellamy Foster et al. (eds.) Hungry for Profit: The Agribusiness Threat to Farmers, Food, and the Environment. New York: Monthly Review Press. pp. 7–21. Foster, J. B. (1999) Marx’s Theory of Metabolic Rift: Classical Foundations for Environmental Sociology. American Journal of Sociology. [Online] 105 (2), 366–405.</p>
<p>Greenpeace Spain (2019) Enganchados a la carne. Cómo la adicción de Europa a la soja alimenta el cambio climático. Madrid: Greepeace Spain. [online]. Available from: <a href="https://es.greenpeace.org/es/sala-de-prensa/informes/enganchados-a-la-carne/" class="uri">https://es.greenpeace.org/es/sala-de-prensa/informes/enganchados-a-la-carne/</a>.</p>
<p>JCCM (2021a) Censo Porcino Castilla La Mancha 2019.</p>
<p>JCCM (2021b) NEVIA: Expedientes de Evaluación Ambiental. [online]. Available from: <a href="https://neva.jccm.es/nevia/forms/nevif100.php" class="uri">https://neva.jccm.es/nevia/forms/nevif100.php</a>.</p>
<p>JCCM (2020) Provincias de Castilla La Mancha (shapefile). [online]. Available from: <a href="https://opendata.esri.es/datasets/castillalamancha" class="uri">https://opendata.esri.es/datasets/castillalamancha</a>::provincias-de-castilla-la-mancha/explore?location=39.577939%2C-2.629719%2C7.88.</p>
<p>Lefebvre, H. et al. (2014) Critique of Everyday Life: the one-volume edition. One-vol. ed. London: Verso. Ríos-Núñez, S. M. &amp; Coq-Huelva, D. (2015) The Transformation of the Spanish Livestock System in the Second and Third Food Regimes: The Transformation of the Spanish Livestock System. Journal of Agrarian Change. [Online] 15 (4), 519–540.</p>
<p>Weis, T. (2013) The Ecological Hoofprint: The Global Burden of Industrial Livestock. London, UNITED KINGDOM: Zed Books. [online]. Available from: <a href="http://ebookcentral.proquest.com/lib/kcl/detail.action?docID=1644030" class="uri">http://ebookcentral.proquest.com/lib/kcl/detail.action?docID=1644030</a> (Accessed 1 April 2021).</p>
<p><img src="images/dancing_pig_1.jpg" /></p>
<p>Miembro de <em>Pueblos Vivos Cuenca</em>, disfrazado como un cerdo durante la <em>Vendimia de la Vergüenza</em>, organizada en Quintanar del Rey. 19/06/2021</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
